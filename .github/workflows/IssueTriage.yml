name: AI Issue Triage

on:
  issues:
    types: [opened]

jobs:
  ai-triage:
    runs-on: ubuntu-latest

    steps:
      - name: AI Issue Classification
        uses: actions/github-script@v7
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        with:
          script: |
            const issue = context.payload.issue;

            const prompt = `
            Classify the issue as bug, feature, task, or security.
            Assign priority (low/medium/high).
            Suggest missing information.

            Title: ${issue.title}
            Description: ${issue.body}
            `;

            const response = await fetch("https://api.openai.com/v1/chat/completions", {
              method: "POST",
              headers: {
                "Authorization": `Bearer ${process.env.OPENAI_API_KEY}`,
                "Content-Type": "application/json"
              },
              body: JSON.stringify({
                model: "gpt-4o-mini",
                messages: [{ role: "user", content: prompt }]
              })
            });

            const data = await response.json();

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.number,
              body: `### ðŸ¤– AI Issue Analysis\n${data.choices[0].message.content}`
            });
